<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>节点信息</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      text-align: center;
    }
    .container {
      max-width: 600px;
      margin: auto;
      text-align: left;
    }
    .node-info {
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 5px;
    }
    .download-link {
      display: inline-block;
      margin-top: 10px;
      padding: 8px 12px;
      background-color: #007bff;
      color: white;
      text-decoration: none;
      border-radius: 5px;
    }
    .download-link:hover {
      background-color: #0056b3;
    }
    button.back-button {
      margin-bottom: 20px;
      padding: 10px 20px;
      background-color: #28a745;
      border: none;
      color: white;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
    }
    button.back-button:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 返回按钮 -->
    <button class="back-button" onclick="goBack()">返回</button>
    <h2>节点列表</h2>
    
    <!-- 节点信息显示区 -->
    <div id="nodes">加载中...</div>
  </div>
  
  <script>
    // 预留的接口：请求服务器接口获取 ping 值
    async function getPing(ip) {
      try {
        // 这里用你自己的服务器接口替换 yourserver.com，
        // 例如：https://api.yourdomain.com/ping?ip=...
        const response = await fetch(`https://yourserver.com/api/ping?ip=${ip}`);
        const data = await response.json();
        return data.ping;  // 期望服务器返回形如 { ping: 50 } 的 JSON 数据
      } catch (e) {
        return "未知";
      }
    }
    
    // 获取并显示节点信息
    async function fetchNodes() {
      // 节点数据数组，每个节点包含基本信息和下载文件内容
      const nodes = [
        {
          name: "节点 1",
          ip: "185.22.153.73",
          port: "56133",
          protocol: "ws",
          country: "荷兰",
          speed: 1000,
          downloadContent: "vmess://ew0KICAidiI6ICIyIiwNCiAgInBzIjogImRvbmd0YWl3YW5nLmNvbVx1ODI4Mlx1NzBCOTEiLA0KICAiYWRkIjogIjE4NS4yMi4xNTMuNzMiLA0KICAicG9ydCI6ICI1NjEzMyIsDQogICJpZCI6ICJhZjdmMDdkYy1kNzI2LTRiMWUtOTY3ZC1kYmI2YzU5NDk5OWYiLA0KICAiYWlkIjogIjAiLA0KICAic2N5IjogImF1dG8iLA0KICAibmV0IjogIndzIiwNCiAgInR5cGUiOiAibm9uZSIsDQogICJob3N0IjogIiIsDQogICJwYXRoIjogImdpdGh1Yi5jb20vQWx2aW45OTk5IiwNCiAgInRscyI6ICIiLA0KICAic25pIjogIiIsDQogICJhbHBuIjogIiIsDQogICJmcCI6ICIiDQp9"
        },
        {
          name: "节点 2",
          ip: "163.172.122.94",
          port: "19188",
          protocol: "tcp",
          country: "法国",
          speed: 800,
          downloadContent: "vless://22a54b72-9c39-4bb0-97d0-41bbaaca2a67@163.172.122.94:19188?encryption=none&flow=xtls-rprx-vision&security=reality&sni=www.yahoo.com&fp=chrome&pbk=tVDaWxsy54q7yRNRdJ718Gyt2HDoh_3R2y_PX22hhjM&sid=95c93be9&type=tcp&headerType=none"
        }
      ];
      
      const container = document.getElementById("nodes");
      container.innerHTML = "";
      
      for (const node of nodes) {
        // 获取实时延时
        node.ping = await getPing(node.ip);
        
        // 为每个节点生成下载链接的 Blob URL
        const blob = new Blob([node.downloadContent], { type: "text/plain" });
        const blobUrl = URL.createObjectURL(blob);
        
        // 构造节点显示区域
        const div = document.createElement("div");
        div.className = "node-info";
        div.innerHTML = `
          <h3>${node.name}</h3>
          <p><strong>加载速率:</strong> ${node.speed}kb</p>
          <p><strong>IP:</strong> ${node.ip}</p>
          <p><strong>端口:</strong> ${node.port}</p>
          <p><strong>通讯协议:</strong> ${node.protocol}</p>
          <p><strong>延时:</strong> ${node.ping}ms</p>
          <p><strong>国家:</strong> ${node.country}</p>
          <a class="download-link" href="${blobUrl}" download="${node.name}.txt">下载节点文件</a>
        `;
        container.appendChild(div);
      }
    }
    
    // 返回上一级页面
    function goBack() {
      window.history.back();
    }
    
    // 页面加载时获取节点信息
    fetchNodes();
  </script>
</body>
</html>